# T√†i li·ªáu AS-001

## 1. Th√¥ng tin C∆° b·∫£n

- **M√£ t√≠nh nƒÉng**: AS-001
- **T√™n t√≠nh nƒÉng**: T·∫°o, ch·ªânh s·ª≠a, x√≥a b√†i thi (CRUD Operations for Assessments)
- **Nh√≥m t√≠nh nƒÉng**: Qu·∫£n l√Ω B√†i thi v√† C√¢u h·ªèi
- **ƒê·ªô ∆∞u ti√™n**: Quan tr·ªçng
- **Tr·∫°ng th√°i**: S·∫µn s√†ng ph√°t tri·ªÉn
- **Ph·ª• thu·ªôc**: AUTH-001 (OAuth2), AUTH-004 (RBAC)

## 2. User Story

L√† m·ªôt gi√°o vi√™n (Teacher)
T√¥i mu·ªën t·∫°o m·ªõi, ch·ªânh s·ª≠a v√† x√≥a c√°c b√†i thi
ƒê·ªÉ c√≥ th·ªÉ qu·∫£n l√Ω n·ªôi dung ƒë√°nh gi√° cho h·ªçc sinh c·ªßa m√¨nh m·ªôt c√°ch linh ho·∫°t v√† hi·ªáu qu·∫£

## 3. Acceptance Criteria

- **T·∫°o b√†i thi m·ªõi**
Khi gi√°o vi√™n truy c·∫≠p ch·ª©c nƒÉng t·∫°o b√†i thi
Th√¨ h·ªç c√≥ th·ªÉ nh·∫≠p th√¥ng tin c∆° b·∫£n (ti√™u ƒë·ªÅ, m√¥ t·∫£, th·ªùi gian l√†m b√†i, ƒëi·ªÉm chu·∫©n)
V√† h·ªá th·ªëng t·∫°o b√†i thi v·ªõi tr·∫°ng th√°i "Draft" m·∫∑c ƒë·ªãnh
- **Ch·ªânh s·ª≠a b√†i thi**
Khi gi√°o vi√™n ch·ªçn ch·ªânh s·ª≠a b√†i thi ƒë√£ t·∫°o
Th√¨ h·ªç c√≥ th·ªÉ c·∫≠p nh·∫≠t t·∫•t c·∫£ th√¥ng tin c·ªßa b√†i thi
V√† ch·ªâ c√≥ th·ªÉ ch·ªânh s·ª≠a b√†i thi ·ªü tr·∫°ng th√°i "Draft" ho·∫∑c l√† ch·ªß s·ªü h·ªØu
- **X√≥a b√†i thi**
Khi gi√°o vi√™n x√≥a m·ªôt b√†i thi
Th√¨ h·ªá th·ªëng x√°c nh·∫≠n tr∆∞·ªõc khi x√≥a
V√† ch·ªâ cho ph√©p x√≥a b√†i thi ch∆∞a c√≥ h·ªçc sinh n√†o tham gia
- **Qu·∫£n l√Ω tr·∫°ng th√°i b√†i thi**
Khi gi√°o vi√™n thay ƒë·ªïi tr·∫°ng th√°i b√†i thi
Th√¨ b√†i thi c√≥ th·ªÉ chuy·ªÉn t·ª´ Draft ‚Üí Active ‚Üí Expired
V√† h·ªçc sinh ch·ªâ c√≥ th·ªÉ th·∫•y v√† l√†m b√†i thi ·ªü tr·∫°ng th√°i "Active"

## 4. ƒê·∫∑c t·∫£ Tr∆∞·ªùng h·ª£p S·ª≠ d·ª•ng

### 4.1 T√°c nh√¢n Ch√≠nh

- **Teacher**: Gi√°o vi√™n t·∫°o v√† qu·∫£n l√Ω b√†i thi
- **Admin**: Qu·∫£n tr·ªã vi√™n c√≥ th·ªÉ qu·∫£n l√Ω t·∫•t c·∫£ b√†i thi
- **System**: H·ªá th·ªëng backend x·ª≠ l√Ω CRUD operations
- **Database**: L∆∞u tr·ªØ th√¥ng tin b√†i thi

### 4.2 ƒêi·ªÅu ki·ªán Ti√™n quy·∫øt

- User ƒë√£ ƒëƒÉng nh·∫≠p th√†nh c√¥ng v·ªõi role "Teacher" ho·∫∑c "Admin"
- Assessment service ƒëang ho·∫°t ƒë·ªông
- Database connection kh·∫£ d·ª•ng
- User c√≥ quy·ªÅn truy c·∫≠p ch·ª©c nƒÉng qu·∫£n l√Ω b√†i thi

### 4.3 Lu·ªìng Ch√≠nh - T·∫°o B√†i thi M·ªõi

1. Teacher truy c·∫≠p trang "Create Assessment"
2. Teacher nh·∫≠p th√¥ng tin b√†i thi:
    - Ti√™u ƒë·ªÅ b√†i thi (b·∫Øt bu·ªôc)
    - M√¥ t·∫£ chi ti·∫øt
    - Th·ªùi gian l√†m b√†i (ph√∫t)
    - ƒêi·ªÉm chu·∫©n ƒë·∫≠u/r·ªõt
    - S·ªë l·∫ßn l√†m b√†i t·ªëi ƒëa
    - Ng√†y h·∫øt h·∫°n
3. System validate d·ªØ li·ªáu ƒë·∫ßu v√†o
4. System t·∫°o assessment m·ªõi v·ªõi status="Draft"
5. System g√°n created_by = current_user_id
6. System tr·∫£ v·ªÅ assessment_id v√† th√¥ng b√°o th√†nh c√¥ng
7. Teacher ƒë∆∞·ª£c redirect ƒë·∫øn trang ch·ªânh s·ª≠a assessment

### 4.4 Lu·ªìng Thay th·∫ø - Ch·ªânh s·ª≠a B√†i thi

1. Teacher truy c·∫≠p danh s√°ch b√†i thi c·ªßa m√¨nh
2. Teacher ch·ªçn b√†i thi c·∫ßn ch·ªânh s·ª≠a
3. System ki·ªÉm tra quy·ªÅn (owner ho·∫∑c admin)
4. System hi·ªÉn th·ªã form ch·ªânh s·ª≠a v·ªõi d·ªØ li·ªáu hi·ªán t·∫°i
5. Teacher c·∫≠p nh·∫≠t th√¥ng tin c·∫ßn thi·∫øt
6. Teacher submit form c·∫≠p nh·∫≠t
7. System validate d·ªØ li·ªáu v√† business rules
8. System c·∫≠p nh·∫≠t database v·ªõi updated_at timestamp
9. System tr·∫£ v·ªÅ th√¥ng b√°o th√†nh c√¥ng

### 4.5 Lu·ªìng Thay th·∫ø - X√≥a B√†i thi

1. Teacher ch·ªçn x√≥a b√†i thi t·ª´ danh s√°ch
2. System ki·ªÉm tra quy·ªÅn v√† ƒëi·ªÅu ki·ªán x√≥a:
    - User l√† owner ho·∫∑c admin
    - B√†i thi ch∆∞a c√≥ attempts n√†o
    - B√†i thi kh√¥ng ƒëang trong tr·∫°ng th√°i "Active" v·ªõi ng∆∞·ªùi thi
3. System hi·ªÉn th·ªã dialog x√°c nh·∫≠n v·ªõi th√¥ng tin r·ªßi ro
4. Teacher x√°c nh·∫≠n x√≥a
5. System th·ª±c hi·ªán soft delete (set deleted_at timestamp)
6. System tr·∫£ v·ªÅ th√¥ng b√°o th√†nh c√¥ng v√† refresh danh s√°ch

### 4.6 X·ª≠ l√Ω Ngo·∫°i l·ªá

**Ngo·∫°i l·ªá E1**: Validation Error

1. D·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá (ti√™u ƒë·ªÅ tr·ªëng, th·ªùi gian √¢m, etc.)
2. System tr·∫£ v·ªÅ HTTP 400 v·ªõi chi ti·∫øt l·ªói validation
3. Frontend hi·ªÉn th·ªã error messages t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng field

**Ngo·∫°i l·ªá E2**: Permission Denied

1. User kh√¥ng c√≥ quy·ªÅn truy c·∫≠p assessment (kh√¥ng ph·∫£i owner/admin)
2. System tr·∫£ v·ªÅ HTTP 403 Forbidden
3. User ƒë∆∞·ª£c redirect v·ªÅ trang danh s√°ch assessments

**Ngo·∫°i l·ªá E3**: Assessment In Use

1. Teacher c·ªë g·∫Øng x√≥a assessment ƒë√£ c√≥ attempts
2. System tr·∫£ v·ªÅ HTTP 409 Conflict
3. Hi·ªÉn th·ªã th√¥ng b√°o kh√¥ng th·ªÉ x√≥a v√† ƒë·ªÅ xu·∫•t archive thay th·∫ø

### 4.7 ƒêi·ªÅu ki·ªán Sau

- Assessment ƒë∆∞·ª£c t·∫°o/c·∫≠p nh·∫≠t th√†nh c√¥ng trong database
- Audit log ghi nh·∫≠n h√†nh ƒë·ªông v·ªõi user_id v√† timestamp
- Cache ƒë∆∞·ª£c invalidate n·∫øu c·∫ßn thi·∫øt
- Notifications ƒë∆∞·ª£c g·ª≠i cho related users n·∫øu c√≥
- Assessment data consistency ƒë∆∞·ª£c ƒë·∫£m b·∫£o

## 4.8 S∆° ƒë·ªì Tu·∫ßn t·ª±

### 4.8.1 T·∫°o B√†i thi M·ªõi

```mermaid
sequenceDiagram
    participant U as Teacher
    participant F as Frontend
    participant A as API Gateway
    participant AS as Assessment Service
    participant DB as Database
    participant AU as Audit Service

    U->>F: Click "Create Assessment"
    F->>U: Show create form
    U->>F: Fill form & submit
    F->>A: POST /assessments
    Note over A: Validate JWT token
    A->>AS: Forward request with user context
    AS->>AS: Validate input data
    AS->>AS: Check user permissions (Teacher/Admin)
    AS->>DB: BEGIN TRANSACTION
    AS->>DB: INSERT INTO assessments
    AS->>DB: INSERT INTO assessment_settings
    AS->>DB: COMMIT TRANSACTION
    AS->>AU: Log assessment creation
    AS->>A: Return created assessment
    A->>F: HTTP 201 + Assessment data
    F->>U: Show success message
    F->>F: Redirect to edit assessment

```

### 4.8.2 Ch·ªânh s·ª≠a B√†i thi

```mermaid
sequenceDiagram
    participant U as Teacher
    participant F as Frontend
    participant A as API Gateway
    participant AS as Assessment Service
    participant DB as Database
    participant AU as Audit Service

    U->>F: Click "Edit Assessment"
    F->>A: GET /assessments/{id}
    A->>AS: Forward request
    AS->>AS: Check user permissions
    AS->>DB: SELECT assessment WHERE id AND created_by
    DB->>AS: Return assessment data
    AS->>A: Return assessment
    A->>F: Assessment data
    F->>U: Show edit form with current data

    U->>F: Update fields & submit
    F->>A: PUT /assessments/{id}
    A->>AS: Forward update request
    AS->>AS: Validate input & permissions
    AS->>AS: Check business rules (status, attempts)
    AS->>DB: BEGIN TRANSACTION
    AS->>DB: UPDATE assessments SET ... WHERE id
    AS->>DB: UPDATE assessment_settings
    AS->>DB: COMMIT TRANSACTION
    AS->>AU: Log assessment modification
    AS->>A: Return updated assessment
    A->>F: HTTP 200 + Updated data
    F->>U: Show success message

```

### 4.8.3 X√≥a B√†i thi

```mermaid
sequenceDiagram
    participant U as Teacher
    participant F as Frontend
    participant A as API Gateway
    participant AS as Assessment Service
    participant DB as Database
    participant AU as Audit Service

    U->>F: Click "Delete Assessment"
    F->>U: Show confirmation dialog
    U->>F: Confirm deletion
    F->>A: DELETE /assessments/{id}
    A->>AS: Forward delete request
    AS->>AS: Check user permissions
    AS->>DB: SELECT COUNT(*) FROM attempts WHERE assessment_id
    DB->>AS: Return attempt count

    alt Has attempts
        AS->>A: HTTP 409 Conflict
        A->>F: Cannot delete error
        F->>U: Show error message
    else No attempts
        AS->>DB: BEGIN TRANSACTION
        AS->>DB: UPDATE assessments SET deleted_at = NOW()
        AS->>DB: COMMIT TRANSACTION
        AS->>AU: Log assessment deletion
        AS->>A: HTTP 204 No Content
        A->>F: Delete successful
        F->>F: Remove from list
        F->>U: Show success message
    end

```

## 4.9 S∆° ƒë·ªì Tr·∫°ng th√°i Assessment

```mermaid
stateDiagram-v2
    [*] --> Draft : Create Assessment

    Draft --> Active : Publish Assessment
    Draft --> Draft : Edit Assessment
    Draft --> Deleted : Delete (if no attempts)

    Active --> Expired : Due Date Reached
    Active --> Expired : Manual Expiration
    Active --> Draft : Unpublish (if no attempts)

    Expired --> Active : Extend Due Date
    Expired --> Archived : Archive Assessment

    Deleted --> [*]
    Archived --> [*]

    note right of Draft
        - Visible to creator only
        - Can be edited freely
        - Can be deleted if no attempts
        - Students cannot see/take
    end note

    note right of Active
        - Visible to assigned students
        - Students can take assessment
        - Limited editing allowed
        - Cannot delete if has attempts
    end note

    note right of Expired
        - No new attempts allowed
        - Existing attempts can continue
        - Results are available
        - Can be reactivated
    end note

    note right of Deleted
        - Soft deleted (deleted_at set)
        - Hidden from UI
        - Data preserved for audit
        - Cannot be restored via UI
    end note

    note right of Archived
        - Read-only state
        - Results preserved
        - Hidden from active lists
        - Can be restored by admin
    end note

```

## 4.10 S∆° ƒë·ªì Tr·∫°ng th√°i Quy·ªÅn Truy c·∫≠p

```mermaid
stateDiagram-v2
    [*] --> CheckAuth : Request Received

    CheckAuth --> Unauthorized : Invalid Token
    CheckAuth --> CheckRole : Valid Token

    CheckRole --> Forbidden : Not Teacher/Admin
    CheckRole --> CheckOwnership : Teacher Role
    CheckRole --> Authorized : Admin Role

    CheckOwnership --> Forbidden : Not Owner
    CheckOwnership --> Authorized : Is Owner

    Authorized --> ProcessRequest : Permission Granted
    ProcessRequest --> Success : Operation Complete
    ProcessRequest --> BusinessError : Business Rule Violation
    ProcessRequest --> SystemError : Technical Error

    Unauthorized --> [*] : Return 401
    Forbidden --> [*] : Return 403
    BusinessError --> [*] : Return 400/409
    SystemError --> [*] : Return 500
    Success --> [*] : Return 200/201/204

    note right of CheckOwnership
        For Teacher role:
        - Can only access own assessments
        - created_by = current_user_id
    end note

    note right of Authorized
        Admin role permissions:
        - Access all assessments
        - Override ownership rules
        - System-wide management
    end note

```

## 5. Y√™u c·∫ßu Ch·ª©c nƒÉng

### 5.1 Quy t·∫Øc Nghi·ªáp v·ª•

- **QT-001**: Ch·ªâ Teacher v√† Admin c√≥ quy·ªÅn t·∫°o assessments
- **QT-002**: Teacher ch·ªâ c√≥ th·ªÉ qu·∫£n l√Ω assessments do m√¨nh t·∫°o
- **QT-003**: Admin c√≥ th·ªÉ qu·∫£n l√Ω t·∫•t c·∫£ assessments trong h·ªá th·ªëng
- **QT-004**: Assessment m·ªõi ƒë∆∞·ª£c t·∫°o v·ªõi tr·∫°ng th√°i "Draft" m·∫∑c ƒë·ªãnh
- **QT-005**: Ch·ªâ c√≥ th·ªÉ x√≥a assessment khi ch∆∞a c√≥ attempts n√†o
- **QT-006**: Assessment title ph·∫£i unique trong ph·∫°m vi c·ªßa creator
- **QT-007**: Th·ªùi gian l√†m b√†i t·ªëi thi·ªÉu 5 ph√∫t, t·ªëi ƒëa 180 ph√∫t
- **QT-008**: ƒêi·ªÉm chu·∫©n ph·∫£i trong kho·∫£ng 0-100
- **QT-009**: Ng√†y h·∫øt h·∫°n ph·∫£i l·ªõn h∆°n ng√†y hi·ªán t·∫°i

### 5.2 Quy t·∫Øc X√°c th·ª±c

- **XT-001**: Title kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng v√† t·ªëi ƒëa 200 k√Ω t·ª±
- **XT-002**: Description t·ªëi ƒëa 1000 k√Ω t·ª±
- **XT-003**: Duration ph·∫£i l√† s·ªë nguy√™n d∆∞∆°ng (5-180 ph√∫t)
- **XT-004**: Passing score ph·∫£i l√† s·ªë trong kho·∫£ng 0-100
- **XT-005**: Max attempts ph·∫£i l√† s·ªë nguy√™n d∆∞∆°ng (1-10)
- **XT-006**: Due date ph·∫£i c√≥ format ISO 8601 h·ª£p l·ªá

### 5.3 Y√™u c·∫ßu D·ªØ li·ªáu

- **D·ªØ li·ªáu ƒê·∫ßu v√†o**:
    - Assessment metadata (title, description, duration, etc.)
    - Assessment settings (randomize, show_results, etc.)
    - Creator information t·ª´ JWT token
- **D·ªØ li·ªáu ƒê·∫ßu ra**:
    - Assessment object v·ªõi full details
    - Operation status v√† messages
    - Updated assessment list for UI refresh
- **D·ªØ li·ªáu L∆∞u tr·ªØ**:
    - Assessments table v·ªõi foreign key t·ªõi Users
    - Assessment settings trong separate table
    - Audit logs cho tracking changes

## 6. Y√™u c·∫ßu Phi ch·ª©c nƒÉng

### 6.1 Hi·ªáu su·∫•t

- Assessment creation: <500ms
- Assessment update: <300ms
- Assessment deletion: <200ms
- Assessment list loading: <200ms with pagination
- Search/filter operations: <300ms

### 6.2 B·∫£o m·∫≠t

- **BM-001**: Implement proper authorization checks cho m·ªçi operation
- **BM-002**: Sanitize v√† validate t·∫•t c·∫£ input data
- **BM-003**: Use parameterized queries ƒë·ªÉ tr√°nh SQL injection
- **BM-004**: Log t·∫•t c·∫£ assessment modifications v·ªõi user tracking
- **BM-005**: Implement rate limiting cho creation operations
- **BM-006**: Encrypt sensitive assessment data n·∫øu c·∫ßn

### 6.3 ƒê·ªô tin c·∫≠y

- **TC-001**: 99.95% availability cho assessment CRUD operations
- **TC-002**: Automatic backup assessment data m·ªói 24 gi·ªù
- **TC-003**: Transaction rollback khi operation fails
- **TC-004**: Graceful error handling v·ªõi user-friendly messages

### 6.4 Kh·∫£ nƒÉng s·ª≠ d·ª•ng

- **SD-001**: Intuitive UI v·ªõi clear action buttons v√† confirmations
- **SD-002**: Real-time validation feedback tr√™n forms
- **SD-003**: Auto-save draft functionality m·ªói 30 gi√¢y
- **SD-004**: Responsive design cho mobile/tablet support
- **SD-005**: Keyboard shortcuts cho power users
- **SD-006**: Bulk operations cho managing multiple assessments

## 7. ƒê·∫∑c t·∫£ API

### 7.1 Assessment Management APIs

```yaml
paths:
  /assessments:
    get:
      summary: List assessments with pagination and filtering
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 10
        - name: status
          in: query
          schema:
            type: string
            enum: [Draft, Active, Expired]
        - name: search
          in: query
          schema:
            type: string
            description: Search trong title v√† description
      responses:
        '200':
          description: Assessment list retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssessmentPage'

    post:
      summary: Create new assessment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssessmentCreateRequest'
      responses:
        '201':
          description: Assessment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Assessment'
        '400':
          description: Validation errors
        '403':
          description: Insufficient permissions

  /assessments/{assessmentId}:
    get:
      summary: Get assessment details by ID
      security:
        - bearerAuth: []
      parameters:
        - name: assessmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Assessment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Assessment'
        '404':
          description: Assessment not found
        '403':
          description: Access denied

    put:
      summary: Update assessment
      security:
        - bearerAuth: []
      parameters:
        - name: assessmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssessmentUpdateRequest'
      responses:
        '200':
          description: Assessment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Assessment'
        '400':
          description: Validation errors
        '403':
          description: Access denied
        '404':
          description: Assessment not found

    delete:
      summary: Delete assessment (soft delete)
      security:
        - bearerAuth: []
      parameters:
        - name: assessmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Assessment deleted successfully
        '403':
          description: Access denied
        '404':
          description: Assessment not found
        '409':
          description: Cannot delete - assessment has attempts

  /assessments/{assessmentId}/status:
    patch:
      summary: Update assessment status
      security:
        - bearerAuth: []
      parameters:
        - name: assessmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [Draft, Active, Expired]
                reason:
                  type: string
                  description: Reason for status change
              required: [status]
      responses:
        '200':
          description: Status updated successfully
        '400':
          description: Invalid status transition
        '403':
          description: Access denied

components:
  schemas:
    Assessment:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        title:
          type: string
          example: "Java Programming Quiz"
        description:
          type: string
          example: "Basic concepts of Java programming"
        duration:
          type: integer
          example: 60
          description: Duration in minutes
        status:
          type: string
          enum: [Draft, Active, Expired]
          example: "Draft"
        passingScore:
          type: integer
          example: 70
          description: Minimum score to pass (0-100)
        maxAttempts:
          type: integer
          example: 2
          description: Maximum attempts allowed
        dueDate:
          type: string
          format: date-time
          example: "2025-03-15T23:59:59Z"
        createdBy:
          type: string
          example: "Mike Johnson"
        createdDate:
          type: string
          format: date-time
          example: "2025-02-15T10:30:00Z"
        updatedDate:
          type: string
          format: date-time
          example: "2025-02-16T14:20:00Z"
        questionsCount:
          type: integer
          example: 4
          description: Number of questions in assessment
        settings:
          $ref: '#/components/schemas/AssessmentSettings'

    AssessmentCreateRequest:
      type: object
      required: [title, duration, passingScore]
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: "Java Programming Quiz"
        description:
          type: string
          maxLength: 1000
          example: "Basic concepts of Java programming"
        duration:
          type: integer
          minimum: 5
          maximum: 180
          example: 60
        passingScore:
          type: integer
          minimum: 0
          maximum: 100
          example: 70
        maxAttempts:
          type: integer
          minimum: 1
          maximum: 10
          example: 2
        dueDate:
          type: string
          format: date-time
          example: "2025-03-15T23:59:59Z"
        settings:
          $ref: '#/components/schemas/AssessmentSettingsRequest'

    AssessmentUpdateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
        description:
          type: string
          maxLength: 1000
        duration:
          type: integer
          minimum: 5
          maximum: 180
        passingScore:
          type: integer
          minimum: 0
          maximum: 100
        maxAttempts:
          type: integer
          minimum: 1
          maximum: 10
        dueDate:
          type: string
          format: date-time
        settings:
          $ref: '#/components/schemas/AssessmentSettingsRequest'

    AssessmentSettings:
      type: object
      properties:
        randomizeQuestions:
          type: boolean
          example: true
        showResults:
          type: boolean
          example: true
        allowRetake:
          type: boolean
          example: false
        timeLimitEnforced:
          type: boolean
          example: true
        requireWebcam:
          type: boolean
          example: true
        preventTabSwitching:
          type: boolean
          example: true
        requireIdentityVerification:
          type: boolean
          example: false

    AssessmentSettingsRequest:
      type: object
      properties:
        randomizeQuestions:
          type: boolean
          default: false
        showResults:
          type: boolean
          default: true
        allowRetake:
          type: boolean
          default: false
        timeLimitEnforced:
          type: boolean
          default: true
        requireWebcam:
          type: boolean
          default: false
        preventTabSwitching:
          type: boolean
          default: false
        requireIdentityVerification:
          type: boolean
          default: false

    AssessmentPage:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/AssessmentSummary'
        pageable:
          $ref: '#/components/schemas/PageableObject'
        totalElements:
          type: integer
          example: 42
        totalPages:
          type: integer
          example: 5
        last:
          type: boolean
          example: false
        first:
          type: boolean
          example: true
        numberOfElements:
          type: integer
          example: 10
        size:
          type: integer
          example: 10
        empty:
          type: boolean
          example: false

    AssessmentSummary:
      type: object
      properties:
        id:
          type: integer
          format: int64
        title:
          type: string
        duration:
          type: integer
        status:
          type: string
          enum: [Draft, Active, Expired]
        dueDate:
          type: string
          format: date-time
        createdBy:
          type: string
        createdDate:
          type: string
          format: date-time
        attempts:
          type: integer
          description: Total number of attempts
        passingScore:
          type: integer
        questionsCount:
          type: integer

```

### 7.2 Database Schema

```sql
-- Assessments table
CREATE TABLE assessments (
    id BIGSERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    duration INTEGER NOT NULL CHECK (duration >= 5 AND duration <= 180),
    status VARCHAR(20) NOT NULL DEFAULT 'Draft' CHECK (status IN ('Draft', 'Active', 'Expired')),
    passing_score INTEGER NOT NULL CHECK (passing_score >= 0 AND passing_score <= 100),
    max_attempts INTEGER NOT NULL DEFAULT 1 CHECK (max_attempts >= 1 AND max_attempts <= 10),
    due_date TIMESTAMP WITH TIME ZONE,
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    deleted_at TIMESTAMP WITH TIME ZONE,

    FOREIGN KEY (created_by) REFERENCES users(id),
    UNIQUE(title, created_by, deleted_at)
);

-- Assessment settings table
CREATE TABLE assessment_settings (
    assessment_id BIGINT PRIMARY KEY,
    randomize_questions BOOLEAN DEFAULT FALSE,
    show_results BOOLEAN DEFAULT TRUE,
    allow_retake BOOLEAN DEFAULT FALSE,
    time_limit_enforced BOOLEAN DEFAULT TRUE,
    require_webcam BOOLEAN DEFAULT FALSE,
    prevent_tab_switching BOOLEAN DEFAULT FALSE,
    require_identity_verification BOOLEAN DEFAULT FALSE,

    FOREIGN KEY (assessment_id) REFERENCES assessments(id) ON DELETE CASCADE
);

-- Indexes for performance
CREATE INDEX idx_assessments_created_by ON assessments(created_by);
CREATE INDEX idx_assessments_status ON assessments(status);
CREATE INDEX idx_assessments_due_date ON assessments(due_date);
CREATE INDEX idx_assessments_deleted_at ON assessments(deleted_at);
CREATE INDEX idx_assessments_title_search ON assessments USING gin(to_tsvector('english', title || ' ' || COALESCE(description, '')));

```

## 8. S∆° ƒë·ªì Ki·∫øn tr√∫c v√† Lu·ªìng D·ªØ li·ªáu

### 8.1 S∆° ƒë·ªì Ki·∫øn tr√∫c T·ªïng quan

```mermaid
graph TB
    subgraph "Client Layer"
        UI[Web UI<br/>React/Vue]
        API_CLIENT[API Client<br/>Axios/Fetch]
    end

    subgraph "API Gateway Layer"
        GATEWAY[API Gateway<br/>Authentication & Routing]
        RATE_LIMITER[Rate Limiter]
        VALIDATOR[Request Validator]
    end

    subgraph "Service Layer"
        AS[Assessment Service<br/>Go/Java]
        AUTH[Auth Service<br/>Casdoor]
        AUDIT[Audit Service]
    end

    subgraph "Data Layer"
        POSTGRES[(PostgreSQL<br/>Assessment Data)]
        REDIS[(Redis<br/>Cache & Sessions)]
        FILES[File Storage<br/>DigitalOcean Spaces]
    end

    UI --> API_CLIENT
    API_CLIENT --> GATEWAY
    GATEWAY --> RATE_LIMITER
    RATE_LIMITER --> VALIDATOR
    VALIDATOR --> AS

    AS --> AUTH
    AS --> AUDIT
    AS --> POSTGRES
    AS --> REDIS
    AS --> FILES

    AUTH --> POSTGRES
    AUDIT --> POSTGRES

```

### 8.2 Lu·ªìng D·ªØ li·ªáu Assessment CRUD

```mermaid
flowchart TD
    START([User Action]) --> AUTH_CHECK{Valid Token?}
    AUTH_CHECK -->|No| RETURN_401[Return 401 Unauthorized]
    AUTH_CHECK -->|Yes| ROLE_CHECK{Teacher/Admin Role?}

    ROLE_CHECK -->|No| RETURN_403[Return 403 Forbidden]
    ROLE_CHECK -->|Yes| OPERATION{Operation Type}

    OPERATION -->|CREATE| VALIDATE_CREATE[Validate Create Data]
    OPERATION -->|READ| CHECK_OWNERSHIP[Check Ownership/Admin]
    OPERATION -->|UPDATE| CHECK_UPDATE_PERM[Check Update Permission]
    OPERATION -->|DELETE| CHECK_DELETE_PERM[Check Delete Permission]

    VALIDATE_CREATE --> CREATE_DB[Insert to Database]
    CHECK_OWNERSHIP -->|Authorized| FETCH_DB[Fetch from Database]
    CHECK_UPDATE_PERM -->|Authorized| VALIDATE_UPDATE[Validate Update Data]
    CHECK_DELETE_PERM -->|Authorized| CHECK_ATTEMPTS[Check Existing Attempts]

    CREATE_DB --> LOG_AUDIT[Log to Audit Service]
    FETCH_DB --> CACHE_RESULT[Cache Result]
    VALIDATE_UPDATE --> UPDATE_DB[Update Database]
    CHECK_ATTEMPTS -->|No Attempts| SOFT_DELETE[Soft Delete Record]
    CHECK_ATTEMPTS -->|Has Attempts| RETURN_409[Return 409 Conflict]

    LOG_AUDIT --> RETURN_SUCCESS[Return Success Response]
    CACHE_RESULT --> RETURN_DATA[Return Assessment Data]
    UPDATE_DB --> LOG_AUDIT
    SOFT_DELETE --> LOG_AUDIT

    CHECK_OWNERSHIP -->|Denied| RETURN_403
    CHECK_UPDATE_PERM -->|Denied| RETURN_403
    CHECK_DELETE_PERM -->|Denied| RETURN_403

    VALIDATE_CREATE -->|Invalid| RETURN_400[Return 400 Bad Request]
    VALIDATE_UPDATE -->|Invalid| RETURN_400

    RETURN_401 --> END([End])
    RETURN_403 --> END
    RETURN_400 --> END
    RETURN_409 --> END
    RETURN_SUCCESS --> END
    RETURN_DATA --> END

```

## 9. Test Cases

### 9.1 Unit Tests

```go
func TestCreateAssessment_Success(t *testing.T) {
    // Test successful assessment creation with valid data
    req := &AssessmentCreateRequest{
        Title: "Test Assessment",
        Duration: 60,
        PassingScore: 70,
    }

    assessment, err := service.CreateAssessment(ctx, req, teacherID)
    assert.NoError(t, err)
    assert.Equal(t, "Test Assessment", assessment.Title)
    assert.Equal(t, "Draft", assessment.Status)
    assert.Equal(t, teacherID, assessment.CreatedBy)
}

func TestCreateAssessment_ValidationError(t *testing.T) {
    // Test validation errors for invalid input
    req := &AssessmentCreateRequest{
        Title: "", // Empty title should fail
        Duration: 300, // Duration too long
        PassingScore: 150, // Invalid passing score
    }

    _, err := service.CreateAssessment(ctx, req, teacherID)
    assert.Error(t, err)
    assert.Contains(t, err.Error(), "title is required")
}

func TestUpdateAssessment_PermissionCheck(t *testing.T) {
    // Test that users can only update their own assessments
    assessment := createTestAssessment(t, teacher1ID)

    req := &AssessmentUpdateRequest{Title: "Updated Title"}
    _, err := service.UpdateAssessment(ctx, assessment.ID, req, teacher2ID)

    assert.Error(t, err)
    assert.Equal(t, ErrAccessDenied, err)
}

```

### 9.2 Integration Tests

```go
func TestAssessmentCRUD_EndToEnd(t *testing.T) {
    // Test complete CRUD flow with database
    // 1. Create assessment
    // 2. Read assessment details
    // 3. Update assessment
    // 4. Delete assessment
    // 5. Verify audit logs
}

func TestAssessmentAPI_Authorization(t *testing.T) {
    // Test API endpoints v·ªõi different roles
    // Student should not be able to create/update/delete
    // Teacher can manage own assessments
    // Admin can manage all assessments
}

```

## 10. Monitoring v√† Alerting

### 10.1 Metrics c·∫ßn theo d√µi

- **Performance Metrics**:
    - API response times cho t·ª´ng endpoint
    - Database query execution times
    - Memory v√† CPU usage c·ªßa Assessment Service
    - Cache hit/miss ratios
- **Business Metrics**:
    - Number of assessments created per day/week
    - Assessment status distribution (Draft/Active/Expired)
    - User adoption rate (active teachers creating assessments)
    - Assessment completion rates
- **Error Metrics**:
    - HTTP error rates (4xx, 5xx)
    - Database connection failures
    - Validation error frequencies
    - Authorization failures

### 10.2 Alerts c·∫ßn thi·∫øt l·∫≠p

```yaml
alerts:
  - name: "High API Response Time"
    condition: "avg(api_response_time) > 500ms"
    severity: "warning"

  - name: "Assessment Creation Failures"
    condition: "rate(assessment_create_errors) > 5%"
    severity: "critical"

  - name: "Database Connection Issues"
    condition: "database_connection_failures > 0"
    severity: "critical"

  - name: "Unauthorized Access Attempts"
    condition: "rate(403_errors) > 10/min"
    severity: "warning"

```

# T√†i li·ªáu ƒê·∫∑c t·∫£ c√°c T√≠nh nƒÉng AS (Assessment System)

## AS-002: Thi·∫øt l·∫≠p th·ªùi gian thi, s·ªë l·∫ßn l√†m b√†i cho ph√©p

**M·ª©c ƒë·ªô**: Normal Change
**Dependencies**: AS-001

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën thi·∫øt l·∫≠p th·ªùi gian l√†m b√†i v√† gi·ªõi h·∫°n s·ªë l·∫ßn thi ƒë·ªÉ ki·ªÉm so√°t ƒëi·ªÅu ki·ªán thi m·ªôt c√°ch linh ho·∫°t.

### Acceptance Criteria
- Thi·∫øt l·∫≠p th·ªùi gian thi: 5-300 ph√∫t
- S·ªë l·∫ßn l√†m b√†i: 1-10 l·∫ßn
- T·ª± ƒë·ªông h·∫øt gi·ªù khi timeout
- Tracking remaining attempts per student

### Technical Implementation
```go
type AssessmentSettings struct {
    Duration     int  `json:"duration" validate:"min=5,max=300"`
    MaxAttempts  int  `json:"max_attempts" validate:"min=1,max=10"`
    TimeWarning  int  `json:"time_warning" default:"300"` // Warn 5 mins before
}

// Extend Assessment model
type Assessment struct {
    // ... existing fields
    TimeSettings AssessmentTimeSettings `gorm:"embedded"`
}
```

### Business Rules
- **QT-001**: Duration c√≥ th·ªÉ thay ƒë·ªïi khi assessment ·ªü tr·∫°ng th√°i Draft
- **QT-002**: Max attempts ch·ªâ c√≥ th·ªÉ tƒÉng, kh√¥ng gi·∫£m khi c√≥ attempts
- **QT-003**: Time warnings ·ªü 50%, 25%, 5 minutes remaining

---

## AS-003: Qu·∫£n l√Ω tr·∫°ng th√°i b√†i thi (Draft, Active, Expired)

**M·ª©c ƒë·ªô**: Normal Change
**Dependencies**: AS-001

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën qu·∫£n l√Ω tr·∫°ng th√°i b√†i thi ƒë·ªÉ ki·ªÉm so√°t khi n√†o h·ªçc sinh c√≥ th·ªÉ l√†m b√†i.

### State Transitions
```mermaid
stateDiagram-v2
    [*] --> Draft
    Draft --> Active : publish()
    Active --> Expired : expire() / due_date
    Expired --> Active : reactivate()
    Draft --> Archived : archive()
    Active --> Archived : archive()
```

### Technical Implementation
- Extend existing status management in AS-001
- Add scheduled job for auto-expiration
- Add bulk status operations

---

## AS-004: Nh·∫≠p/xu·∫•t c√¢u h·ªèi t·ª´ file (Excel, CSV) üì¶ **BIG CHANGE**

**M·ª©c ƒë·ªô**: Big Change
**Dependencies**: AS-001, File Upload Service

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën nh·∫≠p h√†ng lo·∫°t c√¢u h·ªèi t·ª´ file Excel/CSV ƒë·ªÉ ti·∫øt ki·ªám th·ªùi gian t·∫°o b√†i thi.

### Detailed Specification

#### 4.1 Supported File Formats
- **Excel (.xlsx)**: Primary format v·ªõi rich formatting
- **CSV (.csv)**: Simple format v·ªõi UTF-8 encoding
- **JSON**: Structured format cho advanced users

#### 4.2 File Structure Template

**Excel Template:**
```
| Question Type | Question Text | Option A | Option B | Option C | Option D | Correct Answer | Points | Category | Difficulty |
|---------------|---------------|----------|----------|----------|----------|----------------|--------|----------|------------|
| multiple      | What is...?   | Answer 1 | Answer 2 | Answer 3 | Answer 4 | A              | 10     | Math     | Easy       |
| true_false    | Is this...?   | True     | False    |          |          | A              | 5      | Logic    | Medium     |
| essay         | Explain...    |          |          |          |          |                | 20     | Essay    | Hard       |
```

#### 4.3 Import Process Flow

```mermaid
sequenceDiagram
    participant T as Teacher
    participant UI as Frontend
    participant API as Assessment API
    participant FS as File Service
    participant Q as Queue
    participant DB as Database

    T->>UI: Upload file
    UI->>FS: Store file temporarily
    FS->>API: POST /assessments/{id}/questions/import
    API->>Q: Queue import job
    API-->>UI: HTTP 202 Accepted (job_id)
    UI-->>T: "Processing... check back later"

    Q->>API: Process import job
    API->>FS: Download & parse file
    API->>API: Validate questions
    API->>DB: Bulk insert questions
    API->>Q: Publish import_completed event
    Q->>UI: WebSocket notification
    UI-->>T: "Import completed!"
```

#### 4.4 Validation Rules

```go
type QuestionImportValidator struct {
    MaxQuestions    int `default:"1000"`
    MaxFileSize     int `default:"10485760"` // 10MB
    AllowedTypes    []string `default:"multiple,true_false,essay"`
    RequiredFields  []string `default:"question_text,question_type"`
}

type ImportValidationError struct {
    Row     int    `json:"row"`
    Column  string `json:"column"`
    Message string `json:"message"`
    Value   string `json:"value"`
}
```

#### 4.5 Technical Implementation

**File Parser Service:**
```go
type FileParser interface {
    ParseExcel(file io.Reader) (*ImportData, error)
    ParseCSV(file io.Reader) (*ImportData, error)
    ValidateData(data *ImportData) []ImportValidationError
}

type ImportJob struct {
    ID           string    `json:"id"`
    AssessmentID uint      `json:"assessment_id"`
    UserID       uint      `json:"user_id"`
    FileName     string    `json:"file_name"`
    Status       string    `json:"status"` // pending, processing, completed, failed
    Progress     int       `json:"progress"` // 0-100
    TotalRows    int       `json:"total_rows"`
    ProcessedRows int      `json:"processed_rows"`
    Errors       []ImportValidationError `json:"errors"`
    CreatedAt    time.Time `json:"created_at"`
}
```

**Async Processing:**
```go
func (s *QuestionService) ProcessImportJob(ctx context.Context, jobID string) error {
    job, err := s.getImportJob(jobID)
    if err != nil {
        return err
    }

    // Download file
    file, err := s.fileService.Download(job.FilePath)
    if err != nil {
        return s.updateJobStatus(jobID, "failed", err.Error())
    }

    // Parse file
    parser := s.getParser(job.FileType)
    data, err := parser.Parse(file)
    if err != nil {
        return s.updateJobStatus(jobID, "failed", err.Error())
    }

    // Validate data
    errors := parser.ValidateData(data)
    if len(errors) > 0 {
        return s.updateJobWithErrors(jobID, "validation_failed", errors)
    }

    // Batch insert questions
    return s.batchInsertQuestions(ctx, job.AssessmentID, data.Questions, jobID)
}
```

#### 4.6 Export Functionality

```go
type ExportRequest struct {
    AssessmentID uint     `json:"assessment_id"`
    Format       string   `json:"format" validate:"oneof=xlsx csv json"`
    IncludeStats bool     `json:"include_stats"`
    Categories   []string `json:"categories"`
}

func (h *QuestionHandler) ExportQuestions(w http.ResponseWriter, r *http.Request) {
    // Generate export file
    // Stream download to client
    // Log export event
}
```

---

## AS-005: Ph√¢n lo·∫°i c√¢u h·ªèi theo ƒë·ªô kh√≥ v√† ch·ªß ƒë·ªÅ

**M·ª©c ƒë·ªô**: Normal Change
**Dependencies**: AS-004

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën ph√¢n lo·∫°i c√¢u h·ªèi ƒë·ªÉ d·ªÖ d√†ng qu·∫£n l√Ω v√† t·∫°o b√†i thi c√¢n b·∫±ng.

### Technical Implementation
```go
type QuestionCategory struct {
    ID          uint   `json:"id"`
    Name        string `json:"name"`
    Description string `json:"description"`
    Color       string `json:"color"`
    CreatedBy   uint   `json:"created_by"`
}

type Question struct {
    // ... existing fields
    CategoryID   *uint      `json:"category_id"`
    Difficulty   string     `json:"difficulty" validate:"oneof=easy medium hard"`
    Tags         []string   `json:"tags" gorm:"type:text[]"`

    Category     *QuestionCategory `gorm:"foreignKey:CategoryID"`
}
```

### Features
- Hierarchical categories (Math > Algebra > Equations)
- Difficulty: Easy/Medium/Hard with auto-scoring
- Tag system for flexible filtering
- Smart question selection by difficulty distribution

---

## AS-006: H·ªó tr·ª£ nhi·ªÅu lo·∫°i c√¢u h·ªèi: Multiple choice, True/False, Essay üì¶ **BIG CHANGE**

**M·ª©c ƒë·ªô**: Big Change
**Dependencies**: AS-005

### Detailed Question Types Implementation

#### 6.1 Question Type Architecture

```go
type QuestionType string

const (
    MultipleChoice QuestionType = "multiple_choice"
    TrueFalse     QuestionType = "true_false"
    Essay         QuestionType = "essay"
    FillInBlank   QuestionType = "fill_blank"
    Matching      QuestionType = "matching"
    Ordering      QuestionType = "ordering"
)

type Question struct {
    ID           uint         `json:"id"`
    Type         QuestionType `json:"type"`
    Text         string       `json:"text"`
    Points       int          `json:"points"`
    TimeLimit    *int         `json:"time_limit"` // seconds

    // Polymorphic content based on type
    Content      json.RawMessage `json:"content" gorm:"type:jsonb"`

    // Common fields
    Explanation  *string      `json:"explanation"`
    Attachments  []Attachment `json:"attachments"`
}
```

#### 6.2 Question Content Schemas

**Multiple Choice:**
```go
type MultipleChoiceContent struct {
    Options          []Option `json:"options" validate:"min=2,max=10"`
    CorrectAnswers   []int    `json:"correct_answers"`
    Randomize        bool     `json:"randomize"`
    MultipleCorrect  bool     `json:"multiple_correct"`
}

type Option struct {
    ID    string  `json:"id"`
    Text  string  `json:"text"`
    Image *string `json:"image_url"`
}
```

**Essay Question:**
```go
type EssayContent struct {
    MinWords        int      `json:"min_words"`
    MaxWords        int      `json:"max_words"`
    SuggestedLength string   `json:"suggested_length"`
    RubricPoints    []string `json:"rubric_points"`
    SampleAnswer    *string  `json:"sample_answer"`
    AutoGrade       bool     `json:"auto_grade"`
}
```

**Fill in the Blank:**
```go
type FillBlankContent struct {
    Template    string              `json:"template"` // "The capital of {blank1} is {blank2}"
    Blanks      map[string]BlankDef `json:"blanks"`
    CaseSensitive bool              `json:"case_sensitive"`
}

type BlankDef struct {
    AcceptedAnswers []string `json:"accepted_answers"`
    Points          int      `json:"points"`
}
```

#### 6.3 Question Builder UI Component

**Frontend Architecture:**
```typescript
interface QuestionBuilder {
    type: QuestionType;
    content: QuestionContent;
    settings: QuestionSettings;
}

// Vue/React component structure
<QuestionBuilder>
    <TypeSelector @change="handleTypeChange" />

    <!-- Dynamic component based on question type -->
    <MultipleChoiceBuilder v-if="type === 'multiple_choice'" />
    <EssayBuilder v-if="type === 'essay'" />
    <FillBlankBuilder v-if="type === 'fill_blank'" />

    <AttachmentUploader />
    <QuestionPreview />
</QuestionBuilder>
```

#### 6.4 Grading Engine

```go
type GradingEngine interface {
    GradeAnswer(question Question, studentAnswer interface{}) (GradingResult, error)
    GetMaxPoints(question Question) int
}

type MultipleChoiceGrader struct{}
func (g *MultipleChoiceGrader) GradeAnswer(question Question, answer []string) (GradingResult, error) {
    content := unmarshalContent[MultipleChoiceContent](question.Content)

    // Partial credit logic
    correct := 0
    total := len(content.CorrectAnswers)

    for _, studentAnswer := range answer {
        if contains(content.CorrectAnswers, studentAnswer) {
            correct++
        }
    }

    return GradingResult{
        Points: int(float64(question.Points) * float64(correct) / float64(total)),
        Feedback: generateFeedback(correct, total),
    }, nil
}
```

---

## AS-007: Upload v√† qu·∫£n l√Ω file ƒë√≠nh k√®m (h√¨nh ·∫£nh, video, audio)

**M·ª©c ƒë·ªô**: Normal Change
**Dependencies**: File Upload Service

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën ƒë√≠nh k√®m media files v√†o c√¢u h·ªèi ƒë·ªÉ t·∫°o b√†i thi ƒëa ph∆∞∆°ng ti·ªán.

### Technical Implementation
```go
type Attachment struct {
    ID       uint   `json:"id"`
    FileName string `json:"file_name"`
    FileType string `json:"file_type"`
    FileSize int64  `json:"file_size"`
    URL      string `json:"url"`
    MimeType string `json:"mime_type"`
}

// Supported formats
var SupportedFormats = map[string][]string{
    "image": {"jpg", "jpeg", "png", "gif", "webp"},
    "video": {"mp4", "webm", "mov"},
    "audio": {"mp3", "wav", "m4a"},
    "document": {"pdf", "doc", "docx"},
}
```

### Features
- File type validation v√† virus scanning
- Auto-resize images for optimal loading
- Video thumbnail generation
- CDN integration for fast delivery
- Quota management per teacher/organization

---

## AS-008: T·∫°o ng√¢n h√†ng c√¢u h·ªèi v·ªõi kh·∫£ nƒÉng t√°i s·ª≠ d·ª•ng

**M·ª©c ƒë·ªô**: Normal Change
**Dependencies**: AS-006

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën t·∫°o th∆∞ vi·ªán c√¢u h·ªèi ƒë·ªÉ t√°i s·ª≠ d·ª•ng trong nhi·ªÅu b√†i thi kh√°c nhau.

### Technical Implementation
```go
type QuestionBank struct {
    ID          uint   `json:"id"`
    Name        string `json:"name"`
    Description string `json:"description"`
    IsPublic    bool   `json:"is_public"`
    CreatedBy   uint   `json:"created_by"`

    Questions   []Question `gorm:"many2many:question_bank_questions"`
}

type AssessmentQuestion struct {
    AssessmentID uint `json:"assessment_id"`
    QuestionID   uint `json:"question_id"`
    Order        int  `json:"order"`
    Points       int  `json:"points"` // Can override question default points
}
```

### Features
- Personal v√† shared question banks
- Question versioning v√† change tracking
- Bulk import/export between banks
- Usage analytics (most used questions)
- Collaborative editing v·ªõi approval workflow

---

## AS-009: Thi·∫øt l·∫≠p ƒëi·ªÉm s·ªë v√† ti√™u ch√≠ ƒë√°nh gi√°

**M·ª©c ƒë·ªô**: Normal Change
**Dependencies**: AS-006

### User Story
L√† gi√°o vi√™n, t√¥i mu·ªën thi·∫øt l·∫≠p c√°ch t√≠nh ƒëi·ªÉm linh ho·∫°t v√† ti√™u ch√≠ ƒë√°nh gi√° r√µ r√†ng.

### Technical Implementation
```go
type GradingScheme struct {
    ID            uint              `json:"id"`
    AssessmentID  uint              `json:"assessment_id"`
    Type          string            `json:"type"` // percentage, points, letter
    PassingScore  int               `json:"passing_score"`
    GradeRanges   []GradeRange      `json:"grade_ranges"`
    Weightings    []QuestionWeight  `json:"weightings"`
}

type GradeRange struct {
    MinScore  int    `json:"min_score"`
    MaxScore  int    `json:"max_score"`
    Grade     string `json:"grade"`
    Label     string `json:"label"`
}
```

### Features
- Flexible scoring: Points, percentage, letter grades
- Question weighting by category/difficulty
- Partial credit configuration
- Custom rubrics for essay questions
- Grade curve adjustments

---

## Summary & Implementation Priority

### Phase 1 (Core Features)
1. ‚úÖ **AS-001**: CRUD Operations (Completed)
2. üîÑ **AS-002**: Time & Attempt Settings
3. üîÑ **AS-003**: Status Management
4. üîÑ **AS-005**: Question Categories

### Phase 2 (Big Changes)
1. üì¶ **AS-004**: File Import/Export
2. üì¶ **AS-006**: Multiple Question Types
3. üîÑ **AS-007**: File Attachments
4. üîÑ **AS-008**: Question Banks

### Phase 3 (Advanced Features)
1. üîÑ **AS-009**: Advanced Grading
2. Integration v·ªõi Proctoring System
3. Analytics v√† Reporting
4. AI-powered question generation

### Technical Dependencies
- **File Upload Service**: Required for AS-004, AS-007
- **Queue System**: Required for AS-004 (Watermill ‚úÖ)
- **WebSocket**: Required for real-time notifications
- **CDN**: Required for media file delivery
- **AI Service**: Optional for advanced features

M·ªói t√≠nh nƒÉng ƒë·ªÅu c√≥ estimate timeline v√† resource requirements ri√™ng. Big changes nh∆∞ AS-004 v√† AS-006 c·∫ßn 2-3 sprint, normal changes c√≥ th·ªÉ ho√†n th√†nh trong 1 sprint.